<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Untitled Document</title>
<meta name="viewport" content="width=1024, user-scalable=0"/>
<script type="text/javascript" charset="utf-8" src="js/jquery-1.11.3.min.js"></script>
<script type="text/javascript" charset="utf-8" src="js/jquery-ui.min.js"></script>
<script type="text/javascript" charset="utf-8" src="js/jquery.ui.touch-punch.min.js"></script>
<link href="style/style.css" rel="stylesheet" type="text/css">

</head>
<body>
<div class="wrapper">
	<div class="banner">
		<div id="dbsBalance">DBS$</div>		
	</div>
	<div class="main">
		<div class="inputSection">
			<div class="txt">
				請輸入預訂總額<br>
				Input total booking value
			</div>
			<input type="text" id="userInput" placeholder="minium 100 $DBS">
			<input type="submit" value="Go" id="goBtn">
		</div>
		<div class="calSection">
			<div class="mask"></div>
			<p>選擇付款方式 Coose payment method</p>
			<p class='dollorTxt'>HK$</p>
			<div class="calSlider"><div></div></div>
			<p class='dollorTxt'>DBS$</p>
			<p>最少使用 Min. use of 100 DBS$</p>
			<p class='dollorTxt'>&nbsp;總額 Total&nbsp;</p>
			<input type="text" id="totalDBS">
			<p class='dollorTxt'>&nbsp;&nbsp;DBS$&nbsp;<span class="big">+</span>&nbsp;HK$&nbsp;&nbsp;</p>
   			<input type="text" id="totalHKD">
			<input type="reset" value="重設Reset" id="resetBtn">
		</div>
		<img src="image/cardface.gif" width="71" height="45" alt="DBS Card" class="cardFace"/>
		<div class="enrollTxt">立即申請DBS Black World MasterCard並透過iGORewards兌換旅遊獎賞！<br>Apply DBS Black World MasterCard & redeem travel rewards via iGORewards!</div>
		<input type="button" value="立即申請Apply Now" id="applyBtn">
	</div>
</div>
<script type="text/javascript">
$("#userInput").keydown(function(e){
	// Allow: backspace, delete, tab, escape, enter and .
	if ($.inArray(e.keyCode, [46, 8, 9, 27, 13, 110, 190]) !== -1 ||
	// Allow: Ctrl+A
	(e.keyCode == 65 && e.ctrlKey === true) ||
	// Allow: Ctrl+C
	(e.keyCode == 67 && e.ctrlKey === true) ||
	// Allow: Ctrl+X
	(e.keyCode == 88 && e.ctrlKey === true) ||
	// Allow: home, end, left, right
	(e.keyCode >= 35 && e.keyCode <= 39)){
		// let it happen, don't do anything
		return;
	}
	// Ensure that it is a number and stop the keypress
	if ((e.shiftKey || (e.keyCode < 48 || e.keyCode > 57)) && (e.keyCode < 96 || e.keyCode > 105)) {
		e.preventDefault();
	}
});
$("#totalDBS, #totalHKD").keydown(function(e){e.preventDefault()});


var $sliderMin = $('.calSlider').offset().left+$('.calSlider > div').width()/2;
var $sliderMax = $('.calSlider').offset().left+$('.calSlider').width()-$('.calSlider > div').width()/2;
var $sliderRange = $sliderMax-$sliderMin;
var $dbsPercent = 1;
resetCalSlider();


$('#userInput').change(function(){
	if($(this).val()<=0){
		$('#userInput').val('');		
		resetCalSlider();	
	}else if($(this).val()<100){	
		$(this).val(100);
	}else if($(this).val()>18000){	
		$(this).val(18000);
	}
});
$('#goBtn').click(function(){	
	if($('#userInput').val()=='' || $('#userInput').val()==0){		
		$('#userInput').val('');
		$('.calSlider').removeClass('disabled');
		resetCalSlider();	
	}else{
		if($('#userInput').val()<100){
			$('#userInput').val(100);
			$('.calSlider').addClass('disabled')
		}else if($('#userInput').val()==100){			
			$('.calSlider').addClass('disabled')
		}else{
			$('.calSlider').removeClass('disabled');		
		}
		$('.calSection .mask').stop().fadeOut(200);		
		updateDBSVal();	
	}
});
$('#resetBtn').click(function(){	
	$('#userInput').val('');	
	resetCalSlider();
});

function resetCalSlider(){
	$('.calSection .mask').stop().fadeIn(200);
	$dbsPercent = 1;
	window.sliderX = $sliderRange;
	updateDBSVal();
};

$('.calSlider > div').draggable({axis:"x"})
.mousedown(function(){
	if($('#userInput').val()>100){		
		$(document).mousemove(function(e) {
			window.sliderX = Math.min(Math.max($('.calSlider > div').position().left, 0) , $sliderRange);		
			updateDBSVal();
		});		
	}else{
		$(document).mousemove(function(e) {
			window.sliderX =  $sliderRange;		
			updateDBSVal();
		});		
	}
	$('window, html').mouseup(function(){
		$(document).unbind('mousemove');
		$('window, html').unbind('mouseup');		
		updateDBSVal();
	});
})
$('.calSlider').mouseup(function(e){
	if($('#userInput').val()>100){
		window.mouseX = e.pageX;
		window.sliderX = Math.min( Math.max(window.mouseX-$sliderMin, 0) , $sliderRange);	
		updateVal();
	}else{
		window.sliderX =  $sliderRange;		
		updateDBSVal();
	}
});

function updateDBSVal(){
	$dbsPercent = window.sliderX/$sliderRange;
	$('.calSlider > div').css('left', window.sliderX);	
	if($('#userInput').val()==''){
		$('#totalDBS, #totalHKD').val('');
	}else{
		//Math.ceil(($('#userInput').val()-100)*$dbsPercent+100
		$('#totalDBS').val(Math.ceil(($('#userInput').val()-100)*$dbsPercent)+100);
		$('#totalHKD').val(Math.ceil(($('#userInput').val()-100)*1.82*(1-$dbsPercent))+50);
	}
}


</script>
</body>
</html>

(function(e){var t=function(e,t){typeof t=="undefined"&&(t={});this.init(e,t)},n=t.prototype,r,i=["canvas","vml"],s=["oval","spiral","square","rect","roundRect"],o=/^\#([a-fA-F0-9]{6}|[a-fA-F0-9]{3})$/,u=navigator.appVersion.indexOf("MSIE")!==-1&&parseFloat(navigator.appVersion.split("MSIE")[1])===8?true:false,a=!!document.createElement("canvas").getContext,f=true,l=function(e,t,n){var e=document.createElement(e),r;for(r in n)e[r]=n[r];typeof t!=="undefined"&&t.appendChild(e);return e},c=function(e,t){for(var n in t)e.style[n]=t[n];return e},h=function(e,t){for(var n in t)e.setAttribute(n,t[n]);return e},p=function(e,t,n,r){e.save();e.translate(t,n);e.rotate(r);e.translate(-t,-n);e.beginPath()};n.init=function(e,n){if(typeof n.safeVML==="boolean")f=n.safeVML;try{this.mum=document.getElementById(e)!==void 0?document.getElementById(e):document.body}catch(s){this.mum=document.body}n.id=typeof n.id!=="undefined"?n.id:"canvasLoader";this.cont=l("div",this.mum,{id:n.id});if(a)r=i[0],this.can=l("canvas",this.cont),this.con=this.can.getContext("2d"),this.cCan=c(l("canvas",this.cont),{display:"none"}),this.cCon=this.cCan.getContext("2d");else{r=i[1];if(typeof t.vmlSheet==="undefined"){document.getElementsByTagName("head")[0].appendChild(l("style"));t.vmlSheet=document.styleSheets[document.styleSheets.length-1];var o=["group","oval","roundrect","fill"],u;for(u in o)t.vmlSheet.addRule(o[u],"behavior:url(#default#VML); position:absolute;")}this.vml=l("group",this.cont)}this.setColor(this.color);this.draw();c(this.cont,{display:"none"})};n.cont={};n.can={};n.con={};n.cCan={};n.cCon={};n.timer={};n.activeId=0;n.diameter=40;n.setDiameter=function(e){this.diameter=Math.round(Math.abs(e));this.redraw()};n.getDiameter=function(){return this.diameter};n.cRGB={};n.color="#000000";n.setColor=function(e){this.color=o.test(e)?e:"#000000";this.cRGB=this.getRGB(this.color);this.redraw()};n.getColor=function(){return this.color};n.shape=s[0];n.setShape=function(e){for(var t in s)if(e===s[t]){this.shape=e;this.redraw();break}};n.getShape=function(){return this.shape};n.density=40;n.setDensity=function(e){this.density=f&&r===i[1]?Math.round(Math.abs(e))<=40?Math.round(Math.abs(e)):40:Math.round(Math.abs(e));if(this.density>360)this.density=360;this.activeId=0;this.redraw()};n.getDensity=function(){return this.density};n.range=1.3;n.setRange=function(e){this.range=Math.abs(e);this.redraw()};n.getRange=function(){return this.range};n.speed=2;n.setSpeed=function(e){this.speed=Math.round(Math.abs(e))};n.getSpeed=function(){return this.speed};n.fps=24;n.setFPS=function(e){this.fps=Math.round(Math.abs(e));this.reset()};n.getFPS=function(){return this.fps};n.getRGB=function(e){e=e.charAt(0)==="#"?e.substring(1,7):e;return{r:parseInt(e.substring(0,2),16),g:parseInt(e.substring(2,4),16),b:parseInt(e.substring(4,6),16)}};n.draw=function(){var e=0,t,n,o,a,f,d,g,y=this.density,b=Math.round(y*this.range),w,E,S=0;E=this.cCon;var x=this.diameter;if(r===i[0]){E.clearRect(0,0,1e3,1e3);h(this.can,{width:x,height:x});for(h(this.cCan,{width:x,height:x});e<y;){w=e<=b?1-1/b*e:w=0;d=270-360/y*e;g=d/180*Math.PI;E.fillStyle="rgba("+this.cRGB.r+","+this.cRGB.g+","+this.cRGB.b+","+w.toString()+")";switch(this.shape){case s[0]:case s[1]:t=x*.07;a=x*.47+Math.cos(g)*(x*.47-t)-x*.47;f=x*.47+Math.sin(g)*(x*.47-t)-x*.47;E.beginPath();this.shape===s[1]?E.arc(x*.5+a,x*.5+f,t*w,0,Math.PI*2,false):E.arc(x*.5+a,x*.5+f,t,0,Math.PI*2,false);break;case s[2]:t=x*.12;a=Math.cos(g)*(x*.47-t)+x*.5;f=Math.sin(g)*(x*.47-t)+x*.5;p(E,a,f,g);E.fillRect(a,f-t*.5,t,t);break;case s[3]:case s[4]:n=x*.3,o=n*.27,a=Math.cos(g)*(o+(x-o)*.13)+x*.5,f=Math.sin(g)*(o+(x-o)*.13)+x*.5,p(E,a,f,g),this.shape===s[3]?E.fillRect(a,f-o*.5,n,o):(t=o*.55,E.moveTo(a+t,f-o*.5),E.lineTo(a+n-t,f-o*.5),E.quadraticCurveTo(a+n,f-o*.5,a+n,f-o*.5+t),E.lineTo(a+n,f-o*.5+o-t),E.quadraticCurveTo(a+n,f-o*.5+o,a+n-t,f-o*.5+o),E.lineTo(a+t,f-o*.5+o),E.quadraticCurveTo(a,f-o*.5+o,a,f-o*.5+o-t),E.lineTo(a,f-o*.5+t),E.quadraticCurveTo(a,f-o*.5,a+t,f-o*.5))}E.closePath();E.fill();E.restore();++e}}else{c(this.cont,{width:x,height:x});c(this.vml,{width:x,height:x});switch(this.shape){case s[0]:case s[1]:g="oval";t=140;break;case s[2]:g="roundrect";t=120;break;case s[3]:case s[4]:g="roundrect",t=300}n=o=t;a=500-o;for(f=-o*.5;e<y;){w=e<=b?1-1/b*e:w=0;d=270-360/y*e;switch(this.shape){case s[1]:n=o=t*w;a=500-t*.5-t*w*.5;f=(t-t*w)*.5;break;case s[0]:case s[2]:u&&(f=0,this.shape===s[2]&&(a=500-o*.5));break;case s[3]:case s[4]:n=t*.95,o=n*.28,u?(a=0,f=500-o*.5):(a=500-n,f=-o*.5),S=this.shape===s[4]?.6:0}E=h(c(l("group",this.vml),{width:1e3,height:1e3,rotation:d}),{coordsize:"1000,1000",coordorigin:"-500,-500"});E=c(l(g,E,{stroked:false,arcSize:S}),{width:n,height:o,top:f,left:a});l("fill",E,{color:this.color,opacity:w});++e}}this.tick(true)};n.clean=function(){if(r===i[0])this.con.clearRect(0,0,1e3,1e3);else{var e=this.vml;if(e.hasChildNodes())for(;e.childNodes.length>=1;)e.removeChild(e.firstChild)}};n.redraw=function(){this.clean();this.draw()};n.reset=function(){typeof this.timer==="number"&&(this.hide(),this.show())};n.tick=function(e){var t=this.con,n=this.diameter;e||(this.activeId+=360/this.density*this.speed);r===i[0]?(t.clearRect(0,0,n,n),p(t,n*.5,n*.5,this.activeId/180*Math.PI),t.drawImage(this.cCan,0,0,n,n),t.restore()):(this.activeId>=360&&(this.activeId-=360),c(this.vml,{rotation:this.activeId}))};n.show=function(){if(typeof this.timer!=="number"){var e=this;this.timer=self.setInterval(function(){e.tick()},Math.round(1e3/this.fps));c(this.cont,{display:"block"})}};n.hide=function(){typeof this.timer==="number"&&(clearInterval(this.timer),delete this.timer,c(this.cont,{display:"none"}))};n.kill=function(){var e=this.cont;typeof this.timer==="number"&&this.hide();r===i[0]?(e.removeChild(this.can),e.removeChild(this.cCan)):e.removeChild(this.vml);for(var t in this)delete this[t]};e.CanvasLoader=t})(window)